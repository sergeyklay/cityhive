---
description: CityHive Project Overview
globs:
alwaysApply: true
---
# CityHive Project Overview

**Context for AI:** This is a Python 3.12 project using clean architecture patterns with domain-driven design.

## Project Structure

- **Web Application Layer**: `cityhive/app/` - aiohttp web server, routes, views, middleware
- **Domain Layer**: `cityhive/domain/` - Business logic, services, and models
- **Infrastructure Layer**: `cityhive/infrastructure/` - External integrations, database, config
- **Tests**: `tests/unit/` and `tests/integration/` - Comprehensive test coverage required

## Technology Stack

- **Language**: Python 3.12
- **Web Framework**: aiohttp with Jinja2 templates
- **Database**: PostgreSQL + PostGIS with SQLAlchemy async
- **Testing**: Pytest with coverage
- **Package Management**: uv (NEVER pip)
- **Linting**: Ruff (configured in pyproject.toml)

## Web Application Architecture

- **Application Factory**: Async `create_app()` function with dependency injection
- **Type-Safe Storage**: `web.AppKey` for application-wide data
- **Middleware Stack**: Logging → Error handling → Routes
- **Database Context**: SQLAlchemy async sessions with cleanup contexts
- **Health Monitoring**: `/health` endpoint for production monitoring

## Key Development Principles

- **Clean Architecture**: Separate concerns between web, domain, and infrastructure
- **Type Safety**: Type hints required throughout
- **Test-Driven**: All features need tests
- **Domain-Driven**: Business logic stays in domain layer
- **Async-First**: All I/O operations use async/await patterns

## Essential Commands

- **Install dependencies**: `uv add package-name`
- **Run application**: `uv run python -m cityhive.app`
- **Run tests**: `uv run pytest ./tests`
- **Lint code**: `uv run ruff check`
- **Format code**: `uv run ruff format`

## Database

- PostgreSQL with PostGIS extensions
- Alembic migrations in `migration/` directory
- Development database via docker-compose
- Async SQLAlchemy with connection pooling

---

**See also:**
- [python-standards.mdc](mdc:.cursor/rules/python-standards.mdc) for coding conventions
- [testing-guidelines.mdc](mdc:.cursor/rules/testing-guidelines.mdc) for test practices
- [Development Guide](mdc:docs/development.md) for setup and workflows
- [Architecture Guide](mdc:docs/architecture.md) for detailed design patterns
- [Coding Standards](mdc:docs/coding-standards.md) for comprehensive style guide
